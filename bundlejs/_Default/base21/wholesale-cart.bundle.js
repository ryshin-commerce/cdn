"use strict";function Quantity(){this.Extend=function(e,t,a,r){this.DownElement=e,this.UpElement=t,this.TargetElement=a,this.ValueChangeCallBack=r||function(){console.log("ValueChange don't have callback")},this.Process()},this.Process=function(){var t=this;this.UpElement.addEventListener("click",function(e){+t.TargetElement.value<+t.TargetElement.max&&(t.TargetElement.value=++t.TargetElement.value,t.ValueChangeCallBack&&Site.Debounce(t.ValueChangeCallBack(),2e3))}),this.DownElement.addEventListener("click",function(e){+t.TargetElement.value>+t.TargetElement.min&&(t.TargetElement.value=--t.TargetElement.value,t.ValueChangeCallBack&&Site.Debounce(t.ValueChangeCallBack(),2e3))}),this.TargetElement.addEventListener("keyup",function(e){+t.TargetElement.value>+t.TargetElement.max?t.TargetElement.value=+t.TargetElement.max:+t.TargetElement.value<+t.TargetElement.min&&(t.TargetElement.value=+t.TargetElement.min),t.ValueChangeCallBack&&t.ValueChangeCallBack()}),this.TargetElement.addEventListener("change",function(e){t.ValueChangeCallBack&&t.ValueChangeCallBack()})},this.Init=function(e,t){var a=e.querySelector("[data-minus]"),r=e.querySelector("[data-plus]"),e=e.querySelector("input[type='number']");this.Extend(a,r,e,t)}}var categoryContainer,listQuantities,listCheckDropAddresses,curentSelectedDelivery,curentServiceId,curentCategoryId="";function processListItemShopingCartTable(){listQuantities=document.querySelectorAll("._quantity");for(var e=0;e<listQuantities.length;e++)(new Quantity).Init(listQuantities[e],reloadCartMoney)}function processListShippingAddressChange(){(listCheckDropAddresses=document.querySelectorAll("#shippingAddressModel input")).forEach(function(e){e.addEventListener("change",function(e){Site.ClosePopup(),document.querySelector("[data-drop-address]").innerText=e.target.dataset.addressname,document.querySelector("#frmLazyLoadDeliveryExpress [name=DropAddress]").value=e.target.dataset.address,document.querySelector("#frmLazyLoadDeliveryExpress [name=VnDropLocationId]").value=e.target.dataset.vnlocationId,document.querySelector("#frmLazyLoadDeliveryExpress [name=DropLatitude]").value=e.target.dataset.latitude,document.querySelector("#frmLazyLoadDeliveryExpress [name=DropLongitude]").value=e.target.dataset.longitude,document.getElementById("btnLazyLoadDeliveryExpressSelector").click(),document.querySelector("#frmLazyLoadDeliveryNormal [name=DropAddress]").value=e.target.dataset.address,document.querySelector("#frmLazyLoadDeliveryNormal [name=VnDropLocationId]").value=e.target.dataset.vnlocationId,document.getElementById("btnLazyLoadDeliveryNormalSelector").click(),document.querySelector("#frmOrderInfo [name=ShippingAddressId]").value=e.target.dataset.id,document.querySelector("#frmOrderInfo [name=Address]").value=e.target.dataset.address,document.querySelector("#frmOrderInfo [name=VnLocationId]").value=e.target.dataset.vnlocationId})}),0<listCheckDropAddresses.length&&(listCheckDropAddresses[0].dispatchEvent(new Site.CreateEvent("change")),listCheckDropAddresses[0].checked=!0)}function loadDeliverySelector(){}function loadDelivery(){document.getElementById("btnCreateOrder").disabled=!0}function SelectDelivery(e){var t;e&&0!=e.length?(t=+e.dataset.price+ +e.dataset.virtualCost,document.querySelector("[data-delivery-price]").innerHTML=WNumbHelper.GetFrNumber(t),a=e.parentElement.querySelector("img"),document.querySelector("[data-delivery-price-logo]").innerHTML=a.outerHTML):document.querySelector("[data-delivery-price]").innerHTML="NaN";var a=+document.querySelector("[data-summary]").dataset.summary;document.querySelector("[data-total-money]").innerHTML=WNumbHelper.GetFrNumber(a),document.querySelector("#frmOrderInfo [name=ShipmentTypeEnum]").value=e.dataset.shipmentTypeEnum,document.querySelector("#frmOrderInfo [name=ServiceId]").value=e.dataset.serviceId,document.getElementById("btnCreateOrder").disabled=!1,Site.ClosePopup()}function reloadCartMoney(){updateGiftQuantity();for(var e=document.querySelectorAll("[data-class-id]"),t=0,a=0;a<e.length;a++){var r=e[a].querySelector("._quantity"),n=+e[a].querySelector("[data-quantity]").value,r=getUnitPrice(JSON.parse(r.dataset.price),n);e[a].querySelector("[data-unit-price]").innerHTML=WNumbHelper.GetFrNumber(r);n=r*n;t+=n,e[a].querySelector("[data-item-price]").innerHTML=WNumbHelper.GetFrNumber(n)}var l=document.querySelector("[data-summary]");l.innerHTML=WNumbHelper.GetFrNumber(t),l.dataset.summary=t,btnUpdateQuantity.click(),document.querySelector("#frmLazyLoadDeliveryExpress [name=TotalGoodsMoney]").value=t,document.getElementById("btnLazyLoadDeliveryExpressSelector").click(),document.querySelector("#frmLazyLoadDeliveryNormal [name=TotalGoodsMoney]").value=t,document.getElementById("btnLazyLoadDeliveryNormalSelector").click()}function UpdatePriceAndSelectedItem(e,t){curentSelectedDelivery=e||curentSelectedDelivery,curentServiceId=t||curentServiceId;var a,r=document.querySelectorAll("#shippingPriceModel input[type='radio']"),r=Array.from(r),e=null;console.log(t),(e=(e=curentSelectedDelivery?(e=r.filter(function(e){return e.value==curentSelectedDelivery}))&&1<e.length&&curentServiceId?e.filter(function(e){return e.dataset.serviceId==curentServiceId})[0]:(a=e.sort(function(e,t){return 0<+e.dataset.price&&0<+t.dataset.price?+t.dataset.price+ +t.dataset.virtualCost-(+e.dataset.price+ +e.dataset.virtualCost):+e.dataset.price+e.dataset.virtualCost-(+t.dataset.price+ +t.dataset.virtualCost)}),Array.from(a.reverse())[0]):(a=r.sort(function(e,t){return 0<+e.dataset.price&&0<+t.dataset.price?+t.dataset.price+ +t.dataset.virtualCost-(+e.dataset.price+ +e.dataset.virtualCost):+e.dataset.price+e.dataset.virtualCost-(+t.dataset.price+ +t.dataset.virtualCost)}),(a=Array.from(a.reverse()))[0]))||r.filter(function(e){return"None"==e.value})).checked=!0,SelectDelivery(e)}function checkValidQuantity(e){for(var t,a,r,n=[],l=document.querySelectorAll("[data-group-id]"),u=0;u<l.length;u++)0<=Array.from(n).findIndex(function(e){return e===l[u].dataset.groupId})||(t=document.querySelector("[data-group-id='"+l[u].dataset.groupId+"'] [data-product-name]"),r=document.querySelectorAll("[data-group-id='"+l[u].dataset.groupId+"']:not([data-gift]) input[data-quantity]"),0<(a=document.querySelectorAll("[data-group-id='"+l[u].dataset.groupId+"'][data-gift] input[data-quantity]")).length&&(n.push(l[u].dataset.groupId),(r=Array.from(r).reduce(function(e,t){return parseInt(e.value)+parseInt(t.value)}))<Array.from(a).reduce(function(e,t){return parseInt(e.value)+parseInt(t.value)})&&(Site.NotifyFormInfo("THÔNG BÁO",'"Với '+r+" sản phẩm "+t.innerText+'" chỉ được mua tối đa '+r+" sản phẩm trợ giá. Vui lòng giảm số lượng sản phẩm trợ giá"),e.abort())))}function updateGiftQuantity(){for(var e=document.querySelectorAll("[data-gift]"),t=0;t<e.length;t++){var a,r=document.querySelector("[data-group-id='"+e[t].dataset.groupId+"']:not([data-gift])");r&&(a=r.querySelector("[data-quantity]").value,(r=e[t].querySelector("[data-quantity]")).max=+a,+r.value>+r.max&&(r.value=+r.max))}}function getUnitPrice(e,t){for(var a=e[e.length-1].money,r=e.length-1;0<=r&&!(0!==e[r].quantity&&t>=e[r].quantity);r--)a=e[r].money;return a}document.addEventListener("DOMContentLoaded",function(){Site.InitPupup(),processListItemShopingCartTable(),processListShippingAddressChange()});