function Quantity(){this.Extend=function(e,t,a,r){this.DownElement=e,this.UpElement=t,this.TargetElement=a,this.ValueChangeCallBack=r||function(){console.log("ValueChange don't have callback")},this.Process()},this.Process=function(){var e=this;this.UpElement.addEventListener("click",function(t){+e.TargetElement.value<+e.TargetElement.max&&(e.TargetElement.value=++e.TargetElement.value,e.ValueChangeCallBack&&Site.Debounce(e.ValueChangeCallBack(),2e3))}),this.DownElement.addEventListener("click",function(t){+e.TargetElement.value>+e.TargetElement.min&&(e.TargetElement.value=--e.TargetElement.value,e.ValueChangeCallBack&&Site.Debounce(e.ValueChangeCallBack(),2e3))}),this.TargetElement.addEventListener("keyup",function(t){+e.TargetElement.value>+e.TargetElement.max?e.TargetElement.value=+e.TargetElement.max:+e.TargetElement.value<+e.TargetElement.min&&(e.TargetElement.value=+e.TargetElement.min),e.ValueChangeCallBack&&e.ValueChangeCallBack()}),this.TargetElement.addEventListener("change",function(t){e.ValueChangeCallBack&&e.ValueChangeCallBack()})},this.Init=function(e,t){var a=e.querySelector("[data-minus]"),r=e.querySelector("[data-plus]"),n=e.querySelector("input[type='number']");this.Extend(a,r,n,t)}}var categoryContainer,listQuantities,listCheckDropAddresses,curentSelectedDelivery,curentServiceId,curentCategoryId="";function processListItemShopingCartTable(){listQuantities=document.querySelectorAll("._quantity");for(var e=0;e<listQuantities.length;e++){(new Quantity).Init(listQuantities[e],reloadCartMoney)}}function processListShippingAddressChange(){(listCheckDropAddresses=document.querySelectorAll("#shippingAddressModel input")).forEach(e=>{e.addEventListener("change",function(e){Site.ClosePopup(),document.querySelector("[data-drop-address]").innerText=e.target.dataset.addressname,document.querySelector("#frmLazyLoadDeliveryExpress [name=DropAddress]").value=e.target.dataset.address,document.querySelector("#frmLazyLoadDeliveryExpress [name=VnDropLocationId]").value=e.target.dataset.vnlocationId,document.querySelector("#frmLazyLoadDeliveryExpress [name=DropLatitude]").value=e.target.dataset.latitude,document.querySelector("#frmLazyLoadDeliveryExpress [name=DropLongitude]").value=e.target.dataset.longitude,document.getElementById("btnLazyLoadDeliveryExpressSelector").click(),document.querySelector("#frmLazyLoadDeliveryNormal [name=DropAddress]").value=e.target.dataset.address,document.querySelector("#frmLazyLoadDeliveryNormal [name=VnDropLocationId]").value=e.target.dataset.vnlocationId,document.getElementById("btnLazyLoadDeliveryNormalSelector").click(),document.querySelector("#frmOrderInfo [name=ShippingAddressId]").value=e.target.dataset.id,document.querySelector("#frmOrderInfo [name=Address]").value=e.target.dataset.address,document.querySelector("#frmOrderInfo [name=VnLocationId]").value=e.target.dataset.vnlocationId})}),listCheckDropAddresses.length>0&&(listCheckDropAddresses[0].dispatchEvent(new Site.CreateEvent("change")),listCheckDropAddresses[0].checked=!0)}function loadDeliverySelector(){}function loadDelivery(){document.getElementById("btnCreateOrder").disabled=!0}function SelectDelivery(e){var t=0;if(e&&0!=e.length){t=+e.dataset.price+ +e.dataset.virtualCost,document.querySelector("[data-delivery-price]").innerHTML=WNumbHelper.GetFrNumber(t);var a=e.parentElement.querySelector("img");document.querySelector("[data-delivery-price-logo]").innerHTML=a.outerHTML}else document.querySelector("[data-delivery-price]").innerHTML="NaN";var r=+document.querySelector("[data-summary]").dataset.summary;document.querySelector("[data-total-money]").innerHTML=WNumbHelper.GetFrNumber(r),document.querySelector("#frmOrderInfo [name=ShipmentTypeEnum]").value=e.dataset.shipmentTypeEnum,document.querySelector("#frmOrderInfo [name=ServiceId]").value=e.dataset.serviceId,document.getElementById("btnCreateOrder").disabled=!1,Site.ClosePopup()}function reloadCartMoney(){updateGiftQuantity();const e=document.querySelectorAll("[data-class-id]");var t=0;for(let n=0;n<e.length;n++){var a=e[n].querySelector("._quantity");const l=+e[n].querySelector("[data-quantity]").value;var r=getUnitPrice(JSON.parse(a.dataset.price),l);e[n].querySelector("[data-unit-price]").innerHTML=WNumbHelper.GetFrNumber(r);const d=r*l;t+=d,e[n].querySelector("[data-item-price]").innerHTML=WNumbHelper.GetFrNumber(d)}const n=document.querySelector("[data-summary]");n.innerHTML=WNumbHelper.GetFrNumber(t),n.dataset.summary=t,btnUpdateQuantity.click(),document.querySelector("#frmLazyLoadDeliveryExpress [name=TotalGoodsMoney]").value=t,document.getElementById("btnLazyLoadDeliveryExpressSelector").click(),document.querySelector("#frmLazyLoadDeliveryNormal [name=TotalGoodsMoney]").value=t,document.getElementById("btnLazyLoadDeliveryNormalSelector").click()}function UpdatePriceAndSelectedItem(e,t){curentSelectedDelivery=e||curentSelectedDelivery,curentServiceId=t||curentServiceId;var a=document.querySelectorAll("#shippingPriceModel input[type='radio']");a=Array.from(a);var r=null;if(console.log(t),curentSelectedDelivery)if((r=a.filter(e=>e.value==curentSelectedDelivery))&&r.length>1&&curentServiceId)r=r.filter(e=>e.dataset.serviceId==curentServiceId)[0];else{var n=r.sort(function(e,t){return+e.dataset.price>0&&+t.dataset.price>0?+t.dataset.price+ +t.dataset.virtualCost-(+e.dataset.price+ +e.dataset.virtualCost):+e.dataset.price+e.dataset.virtualCost-(+t.dataset.price+ +t.dataset.virtualCost)});r=Array.from(n.reverse())[0]}else{n=a.sort(function(e,t){return+e.dataset.price>0&&+t.dataset.price>0?+t.dataset.price+ +t.dataset.virtualCost-(+e.dataset.price+ +e.dataset.virtualCost):+e.dataset.price+e.dataset.virtualCost-(+t.dataset.price+ +t.dataset.virtualCost)});r=(n=Array.from(n.reverse()))[0]}r||(r=a.find(e=>"None"==e.value)),r&&(r.checked=!0,SelectDelivery(r))}function checkValidQuantity(e){for(var t=[],a=document.querySelectorAll("[data-group-id]"),r=0;r<a.length;r++)if(!(Array.from(t).findIndex(e=>e===a[r].dataset.groupId)>=0)){var n=document.querySelector("[data-group-id='"+a[r].dataset.groupId+"'] [data-product-name]"),l=document.querySelectorAll("[data-group-id='"+a[r].dataset.groupId+"']:not([data-gift]) input[data-quantity]"),d=document.querySelectorAll("[data-group-id='"+a[r].dataset.groupId+"'][data-gift] input[data-quantity]");if(d.length>0){t.push(a[r].dataset.groupId);var o=Array.from(l).reduce(function(e,t){return parseInt(e.value)+parseInt(t.value)});Array.from(d).reduce(function(e,t){return parseInt(e.value)+parseInt(t.value)})>o&&(Site.NotifyFormInfo("THÔNG BÁO",'"Với '+o+" sản phẩm "+n.innerText+'" chỉ được mua tối đa '+o+" sản phẩm trợ giá. Vui lòng giảm số lượng sản phẩm trợ giá"),e.abort())}}}function updateGiftQuantity(){for(var e=document.querySelectorAll("[data-gift]"),t=0;t<e.length;t++){var a=document.querySelector("[data-group-id='"+e[t].dataset.groupId+"']:not([data-gift])");if(a){var r=a.querySelector("[data-quantity]").value,n=e[t].querySelector("[data-quantity]");n.max=+r,+n.value>+n.max&&(n.value=+n.max)}}}function getUnitPrice(e,t){var a=e[e.length-1].money;for(let r=e.length-1;r>=0&&!(0!==e[r].quantity&&t>=e[r].quantity);r--)a=e[r].money;return a}document.addEventListener("DOMContentLoaded",function(){Site.InitPupup(),processListItemShopingCartTable(),processListShippingAddressChange()});