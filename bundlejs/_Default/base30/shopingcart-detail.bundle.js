function Quantity(){this.Extend=function(e,t,a,n){this.DownElement=e,this.UpElement=t,this.TargetElement=a,this.ValueChangeCallBack=n||function(){console.log("ValueChange don't have callback")},this.Process()},this.Process=function(){var t=this;this.UpElement.addEventListener("click",function(e){+t.TargetElement.value<+t.TargetElement.max&&(t.TargetElement.value=++t.TargetElement.value,t.ValueChangeCallBack&&Site.Debounce(t.ValueChangeCallBack(),2e3))}),this.DownElement.addEventListener("click",function(e){+t.TargetElement.value>+t.TargetElement.min&&(t.TargetElement.value=--t.TargetElement.value,t.ValueChangeCallBack&&Site.Debounce(t.ValueChangeCallBack(),2e3))}),this.TargetElement.addEventListener("keyup",function(e){+t.TargetElement.value>+t.TargetElement.max?t.TargetElement.value=+t.TargetElement.max:+t.TargetElement.value<+t.TargetElement.min&&(t.TargetElement.value=+t.TargetElement.min),t.ValueChangeCallBack&&t.ValueChangeCallBack()}),this.TargetElement.addEventListener("change",function(e){t.ValueChangeCallBack&&t.ValueChangeCallBack()})},this.Init=function(e,t){var a=e.querySelector("[data-minus]"),n=e.querySelector("[data-plus]"),e=e.querySelector("input[type='number']");this.Extend(a,n,e,t)}}var listQuantities,summaryElement,btnReloadShopingCartTable,btnRemoveRows,btnUpdateQuantity;function processListItemShopingCartTable(){listQuantities=document.querySelectorAll("._quantity");for(var e=0;e<listQuantities.length;e++)(new Quantity).Init(listQuantities[e],reloadCartMoney)}function updateGiftQuantity(){for(var e=document.querySelectorAll("[data-gift]"),t=0;t<e.length;t++){var a,n=document.querySelector("[data-group-id='"+e[t].dataset.groupId+"']:not([data-gift])");n&&(a=n.querySelector("[data-quantity]").value,(n=e[t].querySelector("[data-quantity]")).max=+a,+n.value>+n.max&&(n.value=+n.max))}}function init(){summaryElement=document.querySelector("[data-summary]"),btnReloadShopingCartTable=document.querySelector("#frmLazyLoadShopingCartTable #btnReloadShopingCartTable"),btnUpdateQuantity=document.getElementById("btnUpdateQuantity")}function removeCartItemComplete(){btnReloadShopingCartTable.click()}function reloadCartMoney(){updateGiftQuantity();const t=document.querySelectorAll("[data-class-id]");var a=0;for(let e=0;e<t.length;e++){var n=t[e].querySelector("._quantity"),r=+t[e].querySelector("[data-quantity]").value,n=getUnitPrice(JSON.parse(n.dataset.price),r);const l=t[e].querySelector("[data-unit-price]");l.innerHTML=WNumbHelper.GetFrNumber(n);const u=t[e].querySelector("[data-item-price]");r=n*r;a+=r,u.innerHTML=WNumbHelper.GetFrNumber(r)}const e=document.querySelector("[data-summary]");e.innerHTML=WNumbHelper.GetFrNumber(a),btnUpdateQuantity.click()}function getUnitPrice(t,a){var n=t[t.length-1].money;for(let e=t.length-1;0<=e&&!(0!==t[e].quantity&&a>=t[e].quantity);e--)n=t[e].money;return n}function checkValidQuantity(e){for(var t,a,n,r=[],l=document.querySelectorAll("[data-group-id]"),u=0;u<l.length;u++)0<=Array.from(r).findIndex(e=>e===l[u].dataset.groupId)||(t=document.querySelector("[data-group-id='"+l[u].dataset.groupId+"'] [data-product-name]"),n=document.querySelectorAll("[data-group-id='"+l[u].dataset.groupId+"']:not([data-gift]) input[data-quantity]"),0<(a=document.querySelectorAll("[data-group-id='"+l[u].dataset.groupId+"'][data-gift] input[data-quantity]")).length&&(r.push(l[u].dataset.groupId),(n=Array.from(n).reduce(function(e,t){return parseInt(e.value)+parseInt(t.value)}))<Array.from(a).reduce(function(e,t){return parseInt(e.value)+parseInt(t.value)})&&(Site.NotifyFormInfo("THÔNG BÁO",'"Với '+n+" sản phẩm "+t.innerText+'" chỉ được mua tối đa '+n+" sản phẩm trợ giá. Vui lòng giảm số lượng sản phẩm trợ giá"),e.abort())))}document.addEventListener("DOMContentLoaded",function(){init(),btnReloadShopingCartTable.click()});