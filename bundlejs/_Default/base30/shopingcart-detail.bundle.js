function Quantity(){this.Extend=function(e,t,a,n){this.DownElement=e,this.UpElement=t,this.TargetElement=a,this.ValueChangeCallBack=n||function(){console.log("ValueChange don't have callback")},this.Process()},this.Process=function(){var e=this;this.UpElement.addEventListener("click",function(t){+e.TargetElement.value<+e.TargetElement.max&&(e.TargetElement.value=++e.TargetElement.value,e.ValueChangeCallBack&&Site.Debounce(e.ValueChangeCallBack(),2e3))}),this.DownElement.addEventListener("click",function(t){+e.TargetElement.value>+e.TargetElement.min&&(e.TargetElement.value=--e.TargetElement.value,e.ValueChangeCallBack&&Site.Debounce(e.ValueChangeCallBack(),2e3))}),this.TargetElement.addEventListener("keyup",function(t){+e.TargetElement.value>+e.TargetElement.max?e.TargetElement.value=+e.TargetElement.max:+e.TargetElement.value<+e.TargetElement.min&&(e.TargetElement.value=+e.TargetElement.min),e.ValueChangeCallBack&&e.ValueChangeCallBack()}),this.TargetElement.addEventListener("change",function(t){e.ValueChangeCallBack&&e.ValueChangeCallBack()})},this.Init=function(e,t){var a=e.querySelector("[data-minus]"),n=e.querySelector("[data-plus]"),r=e.querySelector("input[type='number']");this.Extend(a,n,r,t)}}var listQuantities,summaryElement,btnReloadShopingCartTable,btnRemoveRows,btnUpdateQuantity;function processListItemShopingCartTable(){listQuantities=document.querySelectorAll("._quantity");for(var e=0;e<listQuantities.length;e++){(new Quantity).Init(listQuantities[e],reloadCartMoney)}}function updateGiftQuantity(){for(var e=document.querySelectorAll("[data-gift]"),t=0;t<e.length;t++){var a=document.querySelector("[data-group-id='"+e[t].dataset.groupId+"']:not([data-gift])");if(a){var n=a.querySelector("[data-quantity]").value,r=e[t].querySelector("[data-quantity]");r.max=+n,+r.value>+r.max&&(r.value=+r.max)}}}function init(){summaryElement=document.querySelector("[data-summary]"),btnReloadShopingCartTable=document.querySelector("#frmLazyLoadShopingCartTable #btnReloadShopingCartTable"),btnUpdateQuantity=document.getElementById("btnUpdateQuantity")}function removeCartItemComplete(){btnReloadShopingCartTable.click()}function reloadCartMoney(){updateGiftQuantity();const e=document.querySelectorAll("[data-class-id]");var t=0;for(let r=0;r<e.length;r++){var a=e[r].querySelector("._quantity");const l=+e[r].querySelector("[data-quantity]").value;var n=getUnitPrice(JSON.parse(a.dataset.price),l);e[r].querySelector("[data-unit-price]").innerHTML=WNumbHelper.GetFrNumber(n);const u=n*l;t+=u,e[r].querySelector("[data-item-price]").innerHTML=WNumbHelper.GetFrNumber(u)}document.querySelector("[data-summary]").innerHTML=WNumbHelper.GetFrNumber(t),btnUpdateQuantity.click()}function getUnitPrice(e,t){var a=e[e.length-1].money;for(let n=e.length-1;n>=0&&!(0!==e[n].quantity&&t>=e[n].quantity);n--)a=e[n].money;return a}function checkValidQuantity(e){for(var t=[],a=document.querySelectorAll("[data-group-id]"),n=0;n<a.length;n++)if(!(Array.from(t).findIndex(e=>e===a[n].dataset.groupId)>=0)){var r=document.querySelector("[data-group-id='"+a[n].dataset.groupId+"'] [data-product-name]"),l=document.querySelectorAll("[data-group-id='"+a[n].dataset.groupId+"']:not([data-gift]) input[data-quantity]"),u=document.querySelectorAll("[data-group-id='"+a[n].dataset.groupId+"'][data-gift] input[data-quantity]");if(u.length>0){t.push(a[n].dataset.groupId);var i=Array.from(l).reduce(function(e,t){return parseInt(e.value)+parseInt(t.value)});Array.from(u).reduce(function(e,t){return parseInt(e.value)+parseInt(t.value)})>i&&(Site.NotifyFormInfo("THÔNG BÁO",'"Với '+i+" sản phẩm "+r.innerText+'" chỉ được mua tối đa '+i+" sản phẩm trợ giá. Vui lòng giảm số lượng sản phẩm trợ giá"),e.abort())}}}document.addEventListener("DOMContentLoaded",function(){init(),btnReloadShopingCartTable.click()});